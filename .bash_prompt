#############################################
# ~/.bash_prompt - Prompt limpio, profesional y flexible
# Git branch, K8s/OC, GitHub, estado comando (opcional)
#############################################

# ğŸ‘‰ Activar o desactivar sÃ­mbolos dinÃ¡micos
SHOW_PROMPT_STATUS=false   # âœ”/âœ– al final del prompt (true/false)

# FunciÃ³n para rama Git con estado de suciedad
parse_git_branch() {
  git rev-parse --is-inside-work-tree &>/dev/null || return
  branch=$(git symbolic-ref --short HEAD 2>/dev/null || git describe --tags --exact-match 2>/dev/null)
  dirty=$(git status --porcelain 2>/dev/null | wc -l)
  [ "$dirty" -gt 0 ] && echo "[${branch}*]" || echo "[${branch}]"
}

# SÃ­mbolo de estado Ãºltimo comando (si estÃ¡ activado)
prompt_status_symbol() {
  if [ "$SHOW_PROMPT_STATUS" = true ]; then
    [[ $? == 0 ]] && echo "âœ”" || echo "âœ–"
  fi
}

# Mostrar sÃ­mbolo si estÃ¡s conectado a K8s/OC
kube_prompt() {
  if command -v kubectl >/dev/null 2>&1; then
    current_context=$(kubectl config current-context 2>/dev/null)
    if [[ -n "$current_context" ]]; then
      # Verifica si el servidor responde sin pedir login
      if kubectl get --raw="/" &>/dev/null; then
        echo "âˆ"
      fi
    fi
  fi
}

# Mostrar sÃ­mbolo si estÃ¡s autenticado con GitHub
github_prompt() {
  if grep -q "github.com" ~/.git-credentials 2>/dev/null; then
    echo "ğŸ™"
  fi
}

# Prompt final
PS1='\[\033[1;32m\]\u \[\033[1;34m\]\w \[\033[0;36m\]$(kube_prompt) \[\033[0;33m\]$(parse_git_branch)$(github_prompt) \[\033[1;31m\]$(prompt_status_symbol)\[\033[0m\]\nâ¯ '

